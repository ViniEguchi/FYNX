<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="../css/dashboard-css/dash.css">
  <link rel="stylesheet" href="../css/dashboard-css/global.css">
</head>

<body onload="preencherSetores()">

  <main>
    <div class="side-menu">
      <img class="logo" src="../assets/icon/v5-removebg-preview 2.png">

      <div class="options">
        <!-- <div class="option">
          <img src="../assets/icon/home 3.png" alt="">
          <a href="../dashboard/home.html">HOME</a>
        </div>
        <div class="option selected">
          <img src="../assets/icon/bar-chart (1) 2.png" alt="">
          <a href="../dashboard/dashboard.html">DASHBOARD</a>
        </div>
        <div class="option">
          <img src="../assets/icon/user (1) 2.png" alt="">
          <a href="../dashboard/users.html">USUÁRIOS</a>
        </div>
        <div class="option">
          <img src="../assets/icon/edit 2.png" alt="">
          <a href="../dashboard/perfil.html">EDITAR</a>
        </div>
        <div class="option">
          <img src="../assets/icon/logout 2.png" alt="">
          <a href="../index.html">SAIR</a>
        </div> -->
      </div>
    </div>

    <div class="container">
      <div class="header">
        <div class="container-textos-header">
          <p>DASHBOARD</p>
          <p class="bem-vindo">BEM VINDO, <span id="usuario"></span>!</p>
        </div>
      </div>

      <div class="dashboard-content">
        <div class="dashboard-filters">
          <div id="select_option_setor">
            <!-- <select>
            <option>Setores</option>
          </select> -->
          </div>
          <select>
            <option>Período</option>
            <option>Último Mês</option>
            <option>Últimos Três Meses</option>
            <option>Últimos Seis Meses</option>
            <option>Último Ano</option>
          </select>
        </div>

        <div class="caixa-principal">
          <div class="linha-setores">
            <div class="caixa-setor">
              <p>Média operações no mês</p>
              <div class="caixa-branca" style="display: flex; align-items: center; justify-content: center;">R$ 20.000
              </div>
            </div>
            <div class="caixa-setor">
              <p>Soma crédito concedido</p>
              <div class="caixa-branca" style="display: flex; align-items: center; justify-content: center;">R$ 515.000
              </div>
            </div>
            <div class="caixa-setor">
              <p>Variação crédito p/ mês</p>
              <div class="caixa-branca" style="display: flex; align-items: center; justify-content: center;">+12%</div>
            </div>
          </div>
        </div>

        <div class="charts-container">
          <div class="chart-box">
            <canvas id="grafico1"></canvas>
          </div>
          <div class="chart-box">
            <canvas id="grafico2"></canvas>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    usuario.innerHTML = sessionStorage.NOME_USUARIO;

    const tipoUsuario = sessionStorage.IS_GERENTE;
    const paginaAtual = window.location.pathname;

    const optionsContainer = document.querySelector('.options');

    optionsContainer.innerHTML = `
      <div class="option ${paginaAtual.includes('home.html') ? 'selected' : ''}">
        <img src="../assets/icon/home 3.png" alt="">
        <a href="../dashboard/home.html">HOME</a>
      </div>
      <div class="option ${paginaAtual.includes('dashboard.html') ? 'selected' : ''}">
        <img src="../assets/icon/bar-chart (1) 2.png" alt="">
        <a href="../dashboard/dashboard.html">DASHBOARD</a>
      </div>
      ${tipoUsuario == 1 ? `
        <div class="option ${paginaAtual.includes('users.html') ? 'selected' : ''}">
          <img src="../assets/icon/user (1) 2.png" alt="">
          <a href="../dashboard/users.html">USUÁRIOS</a>
        </div>
      ` : ''}
      <div class="option ${paginaAtual.includes('perfil.html') ? 'selected' : ''}">
        <img src="../assets/icon/edit 2.png" alt="">
        <a href="../dashboard/perfil.html">EDITAR</a>
      </div>
      <div class="option">
        <img src="../assets/icon/logout 2.png" alt="">
        <a href="../index.html">SAIR</a>
      </div>
    `;

    function preencherSetores() {
      fetch("/grafico/preencherSetores", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        }
      })
        .then(function (resposta) {
          if (resposta.ok) {
            console.log("sucesso!");
            resposta.json().then(json => {
              console.log(JSON.stringify(json));

              var opt = '<option>Setores</option>';

              for (let i = 0; i < json.length; i++) {
                opt += `<option>${json[i]}</option>`;
              }

              select_option_setor.innerHTML = `
              <select>
                ${opt}
              </select>
            `;
            })
          } else {
            console.log(resposta)
          }
        })
        .catch(function (erro) {
          console.error("Erro:", erro);
        });
    }

    const ctx1 = document.getElementById('grafico1').getContext('2d');
    const ctx2 = document.getElementById('grafico2').getContext('2d');

    new Chart(ctx1, {
      type: 'line',
      data: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr'],
        datasets: [{
          label: 'Valor médio de operações por mês',
          data: [5000, 500, 7000, 2000],
          borderColor: '#04251F',
          backgroundColor: 'rgba(4, 37, 31, 0.2)',
          fill: true
        }]
      },
      options: {
        plugins: { legend: { display: true } },
        scales: {
          y: { beginAtZero: true }
        },
        responsive: true,
        maintainAspectRatio: false,
      }
    });

    new Chart(ctx2, {
      type: 'line',
      data: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr'],
        datasets: [{
          label: 'Valor de crédito concedido',
          data: [120000, 130000, 125000, 140000],
          borderColor: '#04251F',
          backgroundColor: 'rgba(4, 37, 31, 0.2)',
          fill: true
        }]
      },
      options: {
        plugins: { legend: { display: true } },
        scales: {
          y: { beginAtZero: true }
        },
        responsive: true,
        maintainAspectRatio: false,
      }
    });
  </script>
</body>

</html>